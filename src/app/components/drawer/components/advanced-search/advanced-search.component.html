@if(article()){
  <div class="max-h-screen flex flex-col overflow-auto">
    <section class="p-6 w-full flex flex-col gap-6 border-b border-gray-200">
      <header id="panel-control" class="flex gap-2">
        <div class="grow px-2 flex gap-2 items-center rounded-s rounded-e-none bg-gray-50">
          <input type="search" class="grow focus:outline-none bg-gray-50" aria-label="Search here"
            placeholder="Search by keyword or ask something" [ngModel]="input()" (ngModelChange)="input.set($event)"
            (keydown.enter)="executeSearch()" />

          @if (input() !== '') {
          <button title="Clear search" (click)="clearInput()" (keydown.enter)="clearInput()">
            <i class="fa-fw far fa-circle-xmark"></i>
          </button>
          }
        </div>

        <button class="btn btn-primary rounded-s-none rounded-e disabled:bg-blue-100 disabled:text-blue-500"
          aria-label="Search" [disabled]="input() === ''" (click)="executeSearch()">
          <i class="fa-fw far fa-magnifying-glass"></i>
        </button>
      </header>

      <ul id="panel-content" class="flex flex-col gap-6">
        <!-- extracts comes from the HTML document not from the Article object -->
        @for (extract of extracts(); track $index) {
        <li>
          <p role="button" [id]="'extract-' + extract.relevanceIndex" [innerHTML]="extract.text" (click)="scrollTo(extract)"></p>
        </li>
        }
        @empty {
        <li class="text-slate-300">No relevant extracts found</li>
        }
      </ul>
    </section>

    <section class="p-6 border-b border-gray-200" stkPanel>
      <header id="panel-control" class="flex justify-between items-baseline">
        <p class="flex gap-2 font-semibold items-baseline">
          <i class="fa-fw far fa-tags"></i>
          Labels
        </p>

        <i class="fa-fw far fa-chevron-down panel-control-icon"></i>
      </header>

      <div id="panel-content">
        <ul class="mt-4 flex flex-col flex-wrap gap-2">
          <li>
            <app-metadata [article]="article()!" [metadata]="labels.public" className="pill pill-sm border-black font-semibold"/>
          </li>
          <li>
            <app-metadata [article]="article()!" [metadata]="labels.private" className="pill pill-sm border-black font-semibold"/>
          </li>
        </ul>
      </div>
    </section>

    @if ((article()?.geo ?? []).length > 0) {
    <ng-container *ngTemplateOutlet="metadataPanel; context: {
      metadata: article()!.geo,
      name: 'Location',
      iconClass: 'far fa-location-dot'
    }"></ng-container>
    }

    @if ((article()?.company ?? []).length > 0) {
    <ng-container *ngTemplateOutlet="metadataPanel; context: {
      metadata: article()!.company,
      name: 'Companies',
      iconClass: 'far fa-buildings'
    }"></ng-container>
    }

    @if ((article()?.person ?? []).length > 0) {
    <ng-container *ngTemplateOutlet="metadataPanel; context: {
      metadata: article()!.person,
      name: 'Mentioned',
      iconClass: 'far fa-at'
    }"></ng-container>
    }
  </div>
}

<ng-template #metadataPanel let-metadata="metadata" let-name="name" let-iconClass="iconClass">
  <section class="p-6 border-b border-gray-200" stkPanel>
    <header id="panel-control" class="flex justify-between items-baseline">
      <p class="flex gap-2 font-semibold items-baseline">
        <i class="fa-fw {{ iconClass }}"></i>
        {{ name }}
      </p>

      <i class="fa-fw far fa-chevron-down panel-control-icon"></i>
    </header>

    <div id="panel-content">
      <ul class="flex flex-col gap-2">
        @for (data of metadata; track $index) {
        <li class="pe-2 flex border-black font-semibold justify-between">
          <p>{{ data.display }}</p>
          <p>{{ data.count }}</p>
        </li>
        }
      </ul>
    </div>
  </section>
</ng-template>