<sq-menu
  className="dropdown-content min-w-fit z-50 border-neutral-300 rounded-lg"
>
  <span class="avatar" role="button">{{ initials() }}</span>

  <div menu-content>
    <sq-menu-item>
      <a href="mailto:admin@sinequa.com">
        <i class="fa-regular fa-envelope"></i>
        {{ 'userMenu.contactAdmin' | transloco }}
      </a>
    </sq-menu-item>
    @if(allowUserOverride() && !isOverridingUser()) {
    <sq-menu-item (click)="handleOverride()">
      <svg
        class="size-4"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 21a8 8 0 0 0-16 0" />
        <circle cx="10" cy="8" r="5" />
        <path d="M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3" />
      </svg>
      {{ 'userMenu.overrideUser' | transloco }}
    </sq-menu-item>
    } @else if(isOverridingUser()) {
    <sq-menu-item (click)="handleOverrideUser()">
      <svg
        class="size-4"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 21a8 8 0 0 0-16 0" />
        <circle cx="10" cy="8" r="5" />
        <path d="M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3" />
      </svg>
      {{ 'userMenu.revertOverride' | transloco }}
    </sq-menu-item>
    }
    <sq-menu position="left-start" className="dropdown-content">
      <sq-menu-item>
        <i class="far fa-chevron-left"></i>
        {{ 'userMenu.selectLanguage' | transloco }}
      </sq-menu-item>

      <div menu-content>
        <sq-menu-item (click)="changeLanguage('en')">
          {{ 'userMenu.english' | transloco }}
        </sq-menu-item>

        <sq-menu-item (click)="changeLanguage('fr')">
          {{ 'userMenu.french' | transloco }}
        </sq-menu-item>
      </div>
    </sq-menu>

    <hr class="my-1" />

    <sq-menu-item (click)="handleResetUserSettings()">
      <i class="far fa-trash"></i>
      {{ 'userMenu.resetUserSettings' | transloco }}
    </sq-menu-item>

    @if(!isOverridingUser()) {
    <hr class="my-1" />
    <sq-menu-item (click)="handleLogout()">
      <i class="fa-solid fa-arrow-right-from-bracket"></i>
      {{ 'logout' | transloco }} {{ user().fullName || user().name }}
    </sq-menu-item>
    }
  </div>
</sq-menu>

<dialog
  popover
  class="z-backdrop w-full max-w-md p-4 rounded-lg shadow-lg"
  #overrideUserDialog
>
  <div class="flex flex-col gap-4">
    <p class="text-2xl font-bold">{{ 'userMenu.overrideUser' | transloco }}</p>

    <input
      class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      type="text"
      autocomplete="off"
      spellcheck="false"
      [attr.aria-label]="'userMenu.usernameToOverride' | transloco"
      [attr.placeholder]="'userMenu.usernameToOverride' | transloco"
      [(ngModel)]="overrideUser().username"
    />

    <input
      required
      class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      type="text"
      autocomplete="off"
      spellcheck="false"
      [attr.aria-label]="'userMenu.domainToOverride' | transloco"
      [attr.placeholder]="'userMenu.domainToOverride' | transloco"
      [(ngModel)]="overrideUser().domain"
    />

    <div class="flex justify-between">
      <button class="btn btn-outline w-24" (click)="overrideUserDialog.close()">
        {{ 'cancel' | transloco }}
      </button>

      <button class="btn btn-primary w-24" (click)="override()">
        {{ 'userMenu.override' | transloco }}
      </button>
    </div>
  </div>
</dialog>
